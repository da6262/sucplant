<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🔧 시스템관리 - 경산다육식물농장</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <style>
        .admin-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .stats-card {
            transition: all 0.3s ease;
        }
        .stats-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .tab-button.active {
            background: #667eea;
            color: white;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- 헤더 -->
    <header class="admin-gradient text-white py-6 shadow-lg">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <i class="fas fa-cogs text-3xl"></i>
                    <div>
                        <h1 class="text-3xl font-bold">시스템관리</h1>
                        <p class="text-indigo-200">경산다육식물농장 관리시스템</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="text-right">
                        <p class="text-sm text-indigo-200">부대장님</p>
                        <p class="text-xs text-indigo-300" id="currentTime"></p>
                    </div>
                    <button onclick="location.href='index.html'" 
                        class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-lg transition-all">
                        <i class="fas fa-home mr-2"></i>메인으로
                    </button>
                </div>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-4 py-8">
        <!-- 시스템 현황 대시보드 -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div class="stats-card bg-white rounded-xl shadow-lg p-6">
                <div class="flex items-center">
                    <div class="bg-blue-500 text-white p-3 rounded-lg">
                        <i class="fas fa-database text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-gray-600 text-sm">총 테이블 수</p>
                        <p class="text-2xl font-bold text-gray-800" id="totalTables">12</p>
                    </div>
                </div>
            </div>
            
            <div class="stats-card bg-white rounded-xl shadow-lg p-6">
                <div class="flex items-center">
                    <div class="bg-green-500 text-white p-3 rounded-lg">
                        <i class="fas fa-leaf text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-gray-600 text-sm">등록된 상품</p>
                        <p class="text-2xl font-bold text-gray-800" id="totalProducts">-</p>
                    </div>
                </div>
            </div>
            
            <div class="stats-card bg-white rounded-xl shadow-lg p-6">
                <div class="flex items-center">
                    <div class="bg-yellow-500 text-white p-3 rounded-lg">
                        <i class="fas fa-shopping-cart text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-gray-600 text-sm">총 주문 수</p>
                        <p class="text-2xl font-bold text-gray-800" id="totalOrders">-</p>
                    </div>
                </div>
            </div>
            
            <div class="stats-card bg-white rounded-xl shadow-lg p-6">
                <div class="flex items-center">
                    <div class="bg-purple-500 text-white p-3 rounded-lg">
                        <i class="fas fa-users text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-gray-600 text-sm">등록 고객</p>
                        <p class="text-2xl font-bold text-gray-800" id="totalCustomers">-</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 탭 네비게이션 -->
        <div class="bg-white rounded-xl shadow-lg mb-8">
            <div class="border-b border-gray-200">
                <nav class="flex space-x-8 px-6">
                    <button onclick="showTab('database')" 
                        class="tab-button active py-4 px-2 border-b-2 border-transparent font-medium text-sm focus:outline-none">
                        <i class="fas fa-database mr-2"></i>데이터베이스 관리
                    </button>
                    <button onclick="showTab('settings')" 
                        class="tab-button py-4 px-2 border-b-2 border-transparent font-medium text-sm focus:outline-none">
                        <i class="fas fa-cog mr-2"></i>시스템 설정
                    </button>
                    <button onclick="showTab('logs')" 
                        class="tab-button py-4 px-2 border-b-2 border-transparent font-medium text-sm focus:outline-none">
                        <i class="fas fa-list-alt mr-2"></i>시스템 로그
                    </button>
                    <button onclick="showTab('backup')" 
                        class="tab-button py-4 px-2 border-b-2 border-transparent font-medium text-sm focus:outline-none">
                        <i class="fas fa-archive mr-2"></i>백업 관리
                    </button>
                    <button onclick="showTab('monitoring')" 
                        class="tab-button py-4 px-2 border-b-2 border-transparent font-medium text-sm focus:outline-none">
                        <i class="fas fa-chart-line mr-2"></i>모니터링
                    </button>
                </nav>
            </div>

            <!-- 데이터베이스 관리 탭 -->
            <div id="database" class="tab-content active p-6">
                <h3 class="text-xl font-bold mb-6">🗄️ 데이터베이스 관리</h3>
                
                <!-- 관계형 구조 시각화 -->
                <div class="bg-gray-50 rounded-lg p-6 mb-6">
                    <h4 class="font-bold text-lg mb-4">📊 완전한 관계형 구조</h4>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white p-4 rounded-lg shadow">
                            <h5 class="font-bold text-blue-600 mb-3">핵심 테이블</h5>
                            <div class="space-y-2 text-sm">
                                <div class="flex items-center">
                                    <i class="fas fa-leaf text-green-500 mr-2"></i>
                                    <span><strong>products</strong> (33 fields) → categories, suppliers</span>
                                </div>
                                <div class="flex items-center">
                                    <i class="fas fa-shopping-cart text-blue-500 mr-2"></i>
                                    <span><strong>orders</strong> (26 fields) → customers, order_sources</span>
                                </div>
                                <div class="flex items-center">
                                    <i class="fas fa-list text-purple-500 mr-2"></i>
                                    <span><strong>order_items</strong> (12 fields) → orders, products</span>
                                </div>
                                <div class="flex items-center">
                                    <i class="fas fa-users text-yellow-500 mr-2"></i>
                                    <span><strong>customers</strong> (23 fields)</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white p-4 rounded-lg shadow">
                            <h5 class="font-bold text-purple-600 mb-3">시스템 관리</h5>
                            <div class="space-y-2 text-sm">
                                <div class="flex items-center">
                                    <i class="fas fa-cog text-gray-500 mr-2"></i>
                                    <span><strong>system_settings</strong> (10 fields)</span>
                                </div>
                                <div class="flex items-center">
                                    <i class="fas fa-list-alt text-gray-500 mr-2"></i>
                                    <span><strong>system_logs</strong> (13 fields)</span>
                                </div>
                                <div class="flex items-center">
                                    <i class="fas fa-archive text-gray-500 mr-2"></i>
                                    <span><strong>backup_history</strong> (15 fields)</span>
                                </div>
                                <div class="flex items-center">
                                    <i class="fas fa-warehouse text-gray-500 mr-2"></i>
                                    <span><strong>inventory_logs</strong> (16 fields)</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 테이블 상세 정보 -->
                <div class="bg-white rounded-lg shadow p-6">
                    <h4 class="font-bold text-lg mb-4">📋 테이블 상세 정보</h4>
                    <div id="tablesInfo" class="space-y-4">
                        <!-- 테이블 정보가 여기 로드됩니다 -->
                    </div>
                </div>
            </div>

            <!-- 시스템 설정 탭 -->
            <div id="settings" class="tab-content p-6">
                <h3 class="text-xl font-bold mb-6">⚙️ 시스템 설정</h3>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- 농장 기본 설정 -->
                    <div class="bg-gray-50 rounded-lg p-6">
                        <h4 class="font-bold text-lg mb-4">🌱 농장 기본 설정</h4>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">농장명</label>
                                <input type="text" value="경산다육식물농장" 
                                    class="w-full p-3 border border-gray-300 rounded-lg">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">대표자</label>
                                <input type="text" value="부대장" 
                                    class="w-full p-3 border border-gray-300 rounded-lg">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">연락처</label>
                                <input type="text" placeholder="연락처를 입력하세요" 
                                    class="w-full p-3 border border-gray-300 rounded-lg">
                            </div>
                        </div>
                    </div>
                    
                    <!-- 시스템 환경 설정 -->
                    <div class="bg-gray-50 rounded-lg p-6">
                        <h4 class="font-bold text-lg mb-4">🔧 시스템 환경 설정</h4>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between">
                                <span class="text-sm font-medium">자동 백업</span>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" checked class="sr-only peer">
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                </label>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm font-medium">시스템 로그</span>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" checked class="sr-only peer">
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                </label>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm font-medium">재고 경고</span>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" checked class="sr-only peer">
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mt-6 text-center">
                    <button onclick="saveSettings()" 
                        class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg transition-all">
                        💾 설정 저장
                    </button>
                </div>
            </div>

            <!-- 시스템 로그 탭 -->
            <div id="logs" class="tab-content p-6">
                <h3 class="text-xl font-bold mb-6">📋 시스템 로그</h3>
                
                <div class="bg-gray-900 text-green-400 rounded-lg p-6 font-mono text-sm">
                    <div id="systemLogs">
                        <div class="mb-2">[2024-01-20 10:30:15] INFO: 시스템 시작됨</div>
                        <div class="mb-2">[2024-01-20 10:30:16] INFO: 데이터베이스 연결 성공</div>
                        <div class="mb-2">[2024-01-20 10:30:17] INFO: 12개 테이블 로드 완료</div>
                        <div class="mb-2">[2024-01-20 10:30:18] INFO: 관계형 구조 검증 완료</div>
                        <div class="mb-2">[2024-01-20 10:30:19] INFO: White Platter 전용 설정 적용</div>
                        <div class="mb-2">[2024-01-20 10:30:20] INFO: 시스템 준비 완료</div>
                        <div class="text-yellow-400">[2024-01-20 10:30:21] WARN: 백업 예약 설정 필요</div>
                    </div>
                </div>
                
                <div class="mt-4 flex space-x-4">
                    <button onclick="refreshLogs()" 
                        class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg">
                        🔄 새로고침
                    </button>
                    <button onclick="clearLogs()" 
                        class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg">
                        🗑️ 로그 정리
                    </button>
                    <button onclick="downloadLogs()" 
                        class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
                        💾 로그 다운로드
                    </button>
                </div>
            </div>

            <!-- 백업 관리 탭 -->
            <div id="backup" class="tab-content p-6">
                <h3 class="text-xl font-bold mb-6">💾 백업 관리</h3>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- 백업 생성 -->
                    <div class="bg-gray-50 rounded-lg p-6">
                        <h4 class="font-bold text-lg mb-4">📦 백업 생성</h4>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">백업 유형</label>
                                <select class="w-full p-3 border border-gray-300 rounded-lg">
                                    <option value="full">전체 백업</option>
                                    <option value="incremental">증분 백업</option>
                                    <option value="manual">수동 백업</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">백업명</label>
                                <input type="text" placeholder="백업명을 입력하세요" 
                                    class="w-full p-3 border border-gray-300 rounded-lg">
                            </div>
                            <button onclick="createBackup()" 
                                class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-lg transition-all">
                                🚀 백업 생성
                            </button>
                        </div>
                    </div>
                    
                    <!-- 백업 히스토리 -->
                    <div class="bg-gray-50 rounded-lg p-6">
                        <h4 class="font-bold text-lg mb-4">📋 백업 히스토리</h4>
                        <div class="space-y-3" id="backupHistory">
                            <div class="bg-white p-3 rounded border-l-4 border-green-500">
                                <div class="flex justify-between items-center">
                                    <span class="font-medium">full_backup_2024-01-20</span>
                                    <span class="text-green-600 text-sm">완료</span>
                                </div>
                                <p class="text-gray-600 text-sm">2024-01-20 09:00:00 | 12.5MB</p>
                            </div>
                            <div class="bg-white p-3 rounded border-l-4 border-blue-500">
                                <div class="flex justify-between items-center">
                                    <span class="font-medium">manual_backup_2024-01-19</span>
                                    <span class="text-blue-600 text-sm">완료</span>
                                </div>
                                <p class="text-gray-600 text-sm">2024-01-19 18:30:00 | 8.2MB</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 모니터링 탭 -->
            <div id="monitoring" class="tab-content p-6">
                <h3 class="text-xl font-bold mb-6">📊 시스템 모니터링</h3>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- 데이터 증가 추이 -->
                    <div class="bg-white rounded-lg shadow p-6">
                        <h4 class="font-bold text-lg mb-4">📈 데이터 증가 추이</h4>
                        <canvas id="dataGrowthChart" style="height: 300px;"></canvas>
                    </div>
                    
                    <!-- 시스템 성능 -->
                    <div class="bg-white rounded-lg shadow p-6">
                        <h4 class="font-bold text-lg mb-4">⚡ 시스템 성능</h4>
                        <div class="space-y-4">
                            <div>
                                <div class="flex justify-between mb-2">
                                    <span class="text-sm font-medium">응답 시간</span>
                                    <span class="text-sm text-gray-600">125ms</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2">
                                    <div class="bg-green-600 h-2 rounded-full" style="width: 85%"></div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between mb-2">
                                    <span class="text-sm font-medium">메모리 사용률</span>
                                    <span class="text-sm text-gray-600">67%</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2">
                                    <div class="bg-blue-600 h-2 rounded-full" style="width: 67%"></div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between mb-2">
                                    <span class="text-sm font-medium">API 성공률</span>
                                    <span class="text-sm text-gray-600">99.2%</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2">
                                    <div class="bg-green-600 h-2 rounded-full" style="width: 99%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        console.log('🔧 시스템관리 페이지 로드 시작...');

        // 현재 시간 업데이트
        function updateTime() {
            const now = new Date();
            document.getElementById('currentTime').textContent = now.toLocaleString('ko-KR');
        }
        setInterval(updateTime, 1000);
        updateTime();

        // 탭 전환
        function showTab(tabName) {
            // 모든 탭 숨기기
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // 선택된 탭 보이기
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // 데이터베이스 통계 로드
        async function loadDatabaseStats() {
            console.log('📊 데이터베이스 통계 로드...');
            
            try {
                // 상품 수 조회
                const productsResponse = await fetch('tables/products?limit=1');
                if (productsResponse.ok) {
                    const productsData = await productsResponse.json();
                    document.getElementById('totalProducts').textContent = productsData.total || 0;
                }
                
                // 주문 수 조회
                const ordersResponse = await fetch('tables/orders?limit=1');
                if (ordersResponse.ok) {
                    const ordersData = await ordersResponse.json();
                    document.getElementById('totalOrders').textContent = ordersData.total || 0;
                }
                
                // 고객 수 조회
                const customersResponse = await fetch('tables/customers?limit=1');
                if (customersResponse.ok) {
                    const customersData = await customersResponse.json();
                    document.getElementById('totalCustomers').textContent = customersData.total || 0;
                }
                
                console.log('✅ 데이터베이스 통계 로드 완료');
                
            } catch (error) {
                console.error('❌ 데이터베이스 통계 로드 실패:', error);
            }
        }

        // 테이블 정보 로드
        async function loadTablesInfo() {
            console.log('📋 테이블 정보 로드...');
            
            const tables = [
                { name: 'products', description: '상품 관리', icon: 'fas fa-leaf', color: 'green' },
                { name: 'orders', description: '주문 관리', icon: 'fas fa-shopping-cart', color: 'blue' },
                { name: 'order_items', description: '주문 상품 상세', icon: 'fas fa-list', color: 'purple' },
                { name: 'customers', description: '고객 관리', icon: 'fas fa-users', color: 'yellow' },
                { name: 'categories', description: '카테고리 관리', icon: 'fas fa-tags', color: 'red' },
                { name: 'suppliers', description: '공급업체 관리', icon: 'fas fa-truck', color: 'indigo' },
                { name: 'system_settings', description: '시스템 설정', icon: 'fas fa-cog', color: 'gray' },
                { name: 'system_logs', description: '시스템 로그', icon: 'fas fa-list-alt', color: 'gray' },
                { name: 'backup_history', description: '백업 이력', icon: 'fas fa-archive', color: 'gray' },
                { name: 'inventory_logs', description: '재고 로그', icon: 'fas fa-warehouse', color: 'gray' }
            ];
            
            const tablesInfoDiv = document.getElementById('tablesInfo');
            tablesInfoDiv.innerHTML = '';
            
            tables.forEach(table => {
                const tableDiv = document.createElement('div');
                tableDiv.className = 'bg-gray-50 p-4 rounded-lg flex items-center justify-between';
                tableDiv.innerHTML = `
                    <div class="flex items-center">
                        <i class="${table.icon} text-${table.color}-500 text-xl mr-4"></i>
                        <div>
                            <h5 class="font-bold">${table.name}</h5>
                            <p class="text-gray-600 text-sm">${table.description}</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <button onclick="viewTableSchema('${table.name}')" 
                            class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm">
                            스키마 보기
                        </button>
                    </div>
                `;
                tablesInfoDiv.appendChild(tableDiv);
            });
        }

        // 차트 초기화
        function initCharts() {
            const ctx = document.getElementById('dataGrowthChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['1월', '2월', '3월', '4월', '5월', '6월'],
                    datasets: [{
                        label: '상품 수',
                        data: [12, 19, 23, 25, 28, 32],
                        borderColor: 'rgb(34, 197, 94)',
                        backgroundColor: 'rgba(34, 197, 94, 0.1)',
                        tension: 0.4
                    }, {
                        label: '주문 수',
                        data: [5, 12, 18, 24, 35, 42],
                        borderColor: 'rgb(59, 130, 246)',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: '월별 데이터 증가 추이'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // 시스템 기능들
        function saveSettings() {
            alert('✅ 설정이 저장되었습니다!');
        }

        function refreshLogs() {
            const logsDiv = document.getElementById('systemLogs');
            const newLog = document.createElement('div');
            newLog.className = 'mb-2 text-blue-400';
            newLog.textContent = `[${new Date().toLocaleString()}] INFO: 로그 새로고침 완료`;
            logsDiv.appendChild(newLog);
            logsDiv.scrollTop = logsDiv.scrollHeight;
        }

        function clearLogs() {
            if (confirm('정말 로그를 정리하시겠습니까?')) {
                document.getElementById('systemLogs').innerHTML = '<div class="mb-2 text-green-400">[시스템] 로그가 정리되었습니다.</div>';
            }
        }

        function downloadLogs() {
            alert('📄 로그 파일 다운로드를 시작합니다.');
        }

        function createBackup() {
            if (confirm('백업을 생성하시겠습니까?')) {
                alert('🚀 백업 생성이 시작되었습니다. 완료되면 알림을 드리겠습니다.');
            }
        }

        function viewTableSchema(tableName) {
            alert(`📋 ${tableName} 테이블의 스키마 정보를 표시합니다.`);
        }

        // 페이지 로드 시 초기화
        window.addEventListener('load', function() {
            console.log('🔧 시스템관리 페이지 초기화 완료');
            loadDatabaseStats();
            loadTablesInfo();
            initCharts();
        });
    </script>
</body>
</html>