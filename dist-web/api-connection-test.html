<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ” API ì—°ê²° ìƒíƒœ í™•ì¸ - ê²½ì‚°ë‹¤ìœ¡ì‹ë¬¼ë†ì¥</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .status-good { color: #10b981; }
        .status-warning { color: #f59e0b; }
        .status-error { color: #ef4444; }
        .loading { animation: spin 1s linear infinite; }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .test-item {
            transition: all 0.3s ease;
        }
        .test-item:hover {
            background-color: #f9fafb;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- í—¤ë” -->
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">ğŸ” API ì—°ê²° ìƒíƒœ í™•ì¸</h1>
            <p class="text-gray-600">ê²½ì‚°ë‹¤ìœ¡ì‹ë¬¼ë†ì¥ ê´€ë¦¬ì‹œìŠ¤í…œ - RESTful Table API í…ŒìŠ¤íŠ¸</p>
            <div class="mt-4">
                <button onclick="runAllTests()" 
                    class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg mr-4">
                    ğŸš€ ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
                </button>
                <button onclick="location.href='index.html'" 
                    class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-lg">
                    ğŸ  ë©”ì¸ìœ¼ë¡œ
                </button>
            </div>
        </div>

        <!-- ì—°ê²° ìƒíƒœ ìš”ì•½ -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <h2 class="text-xl font-bold mb-4">ğŸ“Š ì—°ê²° ìƒíƒœ ìš”ì•½</h2>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="text-center p-4 bg-gray-50 rounded-lg">
                    <div class="text-2xl font-bold" id="successCount">-</div>
                    <div class="text-sm text-gray-600">ì„±ê³µ</div>
                </div>
                <div class="text-center p-4 bg-gray-50 rounded-lg">
                    <div class="text-2xl font-bold" id="warningCount">-</div>
                    <div class="text-sm text-gray-600">ê²½ê³ </div>
                </div>
                <div class="text-center p-4 bg-gray-50 rounded-lg">
                    <div class="text-2xl font-bold" id="errorCount">-</div>
                    <div class="text-sm text-gray-600">ì˜¤ë¥˜</div>
                </div>
                <div class="text-center p-4 bg-gray-50 rounded-lg">
                    <div class="text-2xl font-bold" id="responseTime">-</div>
                    <div class="text-sm text-gray-600">í‰ê·  ì‘ë‹µì‹œê°„(ms)</div>
                </div>
            </div>
        </div>

        <!-- API í…ŒìŠ¤íŠ¸ ê²°ê³¼ -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <h2 class="text-xl font-bold mb-4">ğŸ§ª API í…ŒìŠ¤íŠ¸ ê²°ê³¼</h2>
            <div id="testResults" class="space-y-3">
                <!-- í…ŒìŠ¤íŠ¸ ê²°ê³¼ê°€ ì—¬ê¸° í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
        </div>

        <!-- ìƒì„¸ ë¡œê·¸ -->
        <div class="bg-white rounded-xl shadow-lg p-6">
            <h2 class="text-xl font-bold mb-4">ğŸ“‹ ìƒì„¸ ë¡œê·¸</h2>
            <div id="detailLogs" class="bg-gray-900 text-green-400 p-4 rounded-lg font-mono text-sm max-h-96 overflow-y-auto">
                <div>ğŸ” API ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹œì‘...</div>
            </div>
        </div>
    </div>

    <script>
        console.log('ğŸ” API ì—°ê²° ìƒíƒœ í™•ì¸ ë„êµ¬ ì‹œì‘...');

        // ì „ì—­ ë³€ìˆ˜
        let testResults = [];
        let successCount = 0;
        let warningCount = 0;
        let errorCount = 0;
        let totalResponseTime = 0;

        // ë¡œê·¸ ì¶”ê°€ í•¨ìˆ˜
        function addLog(message, type = 'info') {
            const logDiv = document.getElementById('detailLogs');
            const timestamp = new Date().toLocaleTimeString();
            const colorClass = {
                'info': 'text-blue-400',
                'success': 'text-green-400',
                'warning': 'text-yellow-400',
                'error': 'text-red-400'
            }[type] || 'text-gray-400';
            
            const logEntry = document.createElement('div');
            logEntry.className = `mb-1 ${colorClass}`;
            logEntry.textContent = `[${timestamp}] ${message}`;
            logDiv.appendChild(logEntry);
            logDiv.scrollTop = logDiv.scrollHeight;
            
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        // í…ŒìŠ¤íŠ¸ ê²°ê³¼ í‘œì‹œ
        function displayTestResult(testName, status, responseTime, details, error = null) {
            const resultDiv = document.getElementById('testResults');
            const testItem = document.createElement('div');
            testItem.className = 'test-item p-4 border border-gray-200 rounded-lg';
            
            const statusIcon = {
                'success': 'âœ…',
                'warning': 'âš ï¸',
                'error': 'âŒ'
            }[status];
            
            const statusClass = {
                'success': 'status-good',
                'warning': 'status-warning',
                'error': 'status-error'
            }[status];
            
            testItem.innerHTML = `
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <span class="text-xl mr-3">${statusIcon}</span>
                        <div>
                            <h3 class="font-bold ${statusClass}">${testName}</h3>
                            <p class="text-sm text-gray-600">${details}</p>
                            ${error ? `<p class="text-sm text-red-600 mt-1">ì˜¤ë¥˜: ${error}</p>` : ''}
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="font-mono text-sm ${statusClass}">${responseTime}ms</div>
                        <div class="text-xs text-gray-500">${status.toUpperCase()}</div>
                    </div>
                </div>
            `;
            
            resultDiv.appendChild(testItem);
            
            // í†µê³„ ì—…ë°ì´íŠ¸
            if (status === 'success') successCount++;
            else if (status === 'warning') warningCount++;
            else if (status === 'error') errorCount++;
            
            totalResponseTime += responseTime;
            
            updateSummary();
        }

        // ìš”ì•½ í†µê³„ ì—…ë°ì´íŠ¸
        function updateSummary() {
            document.getElementById('successCount').textContent = successCount;
            document.getElementById('warningCount').textContent = warningCount;
            document.getElementById('errorCount').textContent = errorCount;
            
            const avgResponseTime = testResults.length > 0 ? 
                Math.round(totalResponseTime / testResults.length) : 0;
            document.getElementById('responseTime').textContent = avgResponseTime;
        }

        // API í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ë“¤
        async function testApiEndpoint(tableName, method = 'GET', testData = null) {
            const startTime = Date.now();
            let url = `tables/${tableName}`;
            
            if (method === 'GET') {
                url += '?limit=1'; // ìµœì†Œí•œì˜ ë°ì´í„°ë§Œ ìš”ì²­
            }
            
            const options = {
                method: method,
                headers: {
                    'Content-Type': 'application/json'
                }
            };
            
            if (testData && (method === 'POST' || method === 'PUT' || method === 'PATCH')) {
                options.body = JSON.stringify(testData);
            }
            
            try {
                addLog(`${method} ${url} ìš”ì²­ ì‹œì‘...`);
                const response = await fetch(url, options);
                const responseTime = Date.now() - startTime;
                
                if (response.ok) {
                    const data = await response.json();
                    const details = `ìƒíƒœ: ${response.status}, ë°ì´í„°: ${JSON.stringify(data).length}bytes`;
                    
                    addLog(`âœ… ${method} ${url} ì„±ê³µ (${responseTime}ms)`, 'success');
                    displayTestResult(
                        `${method} /${tableName}`, 
                        'success', 
                        responseTime, 
                        details
                    );
                    
                    return { success: true, data, responseTime };
                } else {
                    const errorText = await response.text();
                    const details = `HTTP ${response.status}: ${response.statusText}`;
                    
                    addLog(`âŒ ${method} ${url} ì‹¤íŒ¨: ${details}`, 'error');
                    displayTestResult(
                        `${method} /${tableName}`, 
                        'error', 
                        responseTime, 
                        details,
                        errorText
                    );
                    
                    return { success: false, error: errorText, responseTime };
                }
            } catch (error) {
                const responseTime = Date.now() - startTime;
                const details = 'ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ë˜ëŠ” CORS ë¬¸ì œ';
                
                addLog(`âŒ ${method} ${url} ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ${error.message}`, 'error');
                displayTestResult(
                    `${method} /${tableName}`, 
                    'error', 
                    responseTime, 
                    details,
                    error.message
                );
                
                return { success: false, error: error.message, responseTime };
            }
        }

        // í…Œì´ë¸” ì¡´ì¬ ì—¬ë¶€ í™•ì¸
        async function testTableExists(tableName) {
            addLog(`ğŸ“‹ ${tableName} í…Œì´ë¸” ì¡´ì¬ ì—¬ë¶€ í™•ì¸...`);
            const result = await testApiEndpoint(tableName, 'GET');
            testResults.push(result);
            return result;
        }

        // ê¸°ë³¸ CRUD í…ŒìŠ¤íŠ¸
        async function testBasicCrud(tableName) {
            addLog(`ğŸ§ª ${tableName} ê¸°ë³¸ CRUD í…ŒìŠ¤íŠ¸ ì‹œì‘...`);
            
            // 1. READ í…ŒìŠ¤íŠ¸
            await testTableExists(tableName);
            
            // 2. í…ŒìŠ¤íŠ¸ ë°ì´í„°ë¡œ CREATE ì‹œë„ (ì‹¤ì œë¡œëŠ” í•˜ì§€ ì•ŠìŒ)
            // ì‹¤ì œ ë°ì´í„° ìƒì„±ì€ ìœ„í—˜í•˜ë¯€ë¡œ ìŠ¤í‚¤ë§ˆë§Œ í™•ì¸
        }

        // ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
        async function runAllTests() {
            addLog('ğŸš€ ì „ì²´ API ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'info');
            
            // í†µê³„ ì´ˆê¸°í™”
            successCount = 0;
            warningCount = 0;
            errorCount = 0;
            totalResponseTime = 0;
            testResults = [];
            document.getElementById('testResults').innerHTML = '';
            
            // í…ŒìŠ¤íŠ¸í•  í…Œì´ë¸” ëª©ë¡
            const tables = [
                'products',
                'orders', 
                'order_items',
                'customers',
                'categories',
                'suppliers',
                'system_settings',
                'system_logs',
                'backup_history',
                'inventory_logs',
                'user_sessions',
                'order_sources',
                'waitlist'
            ];
            
            addLog(`ğŸ“‹ ${tables.length}ê°œ í…Œì´ë¸” ì—°ê²° ìƒíƒœ í™•ì¸ ì¤‘...`);
            
            // ê° í…Œì´ë¸” í…ŒìŠ¤íŠ¸
            for (const tableName of tables) {
                await testBasicCrud(tableName);
                
                // í…ŒìŠ¤íŠ¸ ê°„ ê°„ê²©
                await new Promise(resolve => setTimeout(resolve, 100));
            }
            
            // ì¶”ê°€ ì—°ê²° í…ŒìŠ¤íŠ¸
            await testApiConnectivity();
            
            // ìµœì¢… ê²°ê³¼
            addLog('âœ… ì „ì²´ API ì—°ê²° í…ŒìŠ¤íŠ¸ ì™„ë£Œ!', 'success');
            
            // ê²°ê³¼ ìš”ì•½
            const totalTests = testResults.length;
            const successRate = totalTests > 0 ? ((successCount / totalTests) * 100).toFixed(1) : 0;
            
            addLog(`ğŸ“Š í…ŒìŠ¤íŠ¸ ê²°ê³¼: ${successCount}ì„±ê³µ, ${warningCount}ê²½ê³ , ${errorCount}ì˜¤ë¥˜`, 'info');
            addLog(`ğŸ“ˆ ì„±ê³µë¥ : ${successRate}% (${successCount}/${totalTests})`, 'info');
            
            if (successRate >= 80) {
                addLog('ğŸ‰ API ì—°ê²° ìƒíƒœ ì–‘í˜¸!', 'success');
            } else if (successRate >= 50) {
                addLog('âš ï¸ API ì—°ê²° ìƒíƒœ ì£¼ì˜ í•„ìš”', 'warning');
            } else {
                addLog('âŒ API ì—°ê²° ìƒíƒœ ì‹¬ê°í•œ ë¬¸ì œ', 'error');
            }
        }

        // API ì—°ê²°ì„± í…ŒìŠ¤íŠ¸
        async function testApiConnectivity() {
            addLog('ğŸŒ API ì„œë²„ ì—°ê²°ì„± í…ŒìŠ¤íŠ¸...', 'info');
            
            // 1. Base URL í…ŒìŠ¤íŠ¸
            try {
                const startTime = Date.now();
                const response = await fetch('tables/products?limit=1');
                const responseTime = Date.now() - startTime;
                
                if (response.ok) {
                    addLog('âœ… API ì„œë²„ ì—°ê²° ì„±ê³µ', 'success');
                    displayTestResult(
                        'API ì„œë²„ ì—°ê²°', 
                        'success', 
                        responseTime, 
                        'ì„œë²„ ì‘ë‹µ ì •ìƒ'
                    );
                } else {
                    addLog(`âš ï¸ API ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜: ${response.status}`, 'warning');
                    displayTestResult(
                        'API ì„œë²„ ì—°ê²°', 
                        'warning', 
                        responseTime, 
                        `HTTP ${response.status} ì‘ë‹µ`
                    );
                }
            } catch (error) {
                addLog(`âŒ API ì„œë²„ ì—°ê²° ì‹¤íŒ¨: ${error.message}`, 'error');
                displayTestResult(
                    'API ì„œë²„ ì—°ê²°', 
                    'error', 
                    0, 
                    'ì—°ê²° ë¶ˆê°€',
                    error.message
                );
            }
            
            // 2. CORS í—¤ë” í™•ì¸
            addLog('ğŸ”’ CORS ì„¤ì • í™•ì¸...', 'info');
            
            // 3. ë„¤íŠ¸ì›Œí¬ ìƒíƒœ í™•ì¸
            if (navigator.onLine) {
                addLog('ğŸŒ ë„¤íŠ¸ì›Œí¬ ì—°ê²° ìƒíƒœ: ì˜¨ë¼ì¸', 'success');
            } else {
                addLog('âŒ ë„¤íŠ¸ì›Œí¬ ì—°ê²° ìƒíƒœ: ì˜¤í”„ë¼ì¸', 'error');
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì‹¤í–‰
        window.addEventListener('load', function() {
            addLog('ğŸ“„ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ', 'info');
            addLog('ğŸ’¡ "ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰" ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ API ìƒíƒœë¥¼ í™•ì¸í•˜ì„¸ìš”.', 'info');
        });

        // ë„¤íŠ¸ì›Œí¬ ìƒíƒœ ëª¨ë‹ˆí„°ë§
        window.addEventListener('online', () => {
            addLog('ğŸŒ ë„¤íŠ¸ì›Œí¬ ì—°ê²° ë³µêµ¬ë¨', 'success');
        });

        window.addEventListener('offline', () => {
            addLog('âŒ ë„¤íŠ¸ì›Œí¬ ì—°ê²° ëŠì–´ì§', 'error');
        });
    </script>
</body>
</html>