<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>캐시 무효화 도구 - 경산다육식물농장</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <div class="max-w-4xl mx-auto">
            <!-- 헤더 -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-2xl font-bold text-gray-800">
                            <i class="fas fa-broom text-blue-600 mr-2"></i>
                            캐시 무효화 도구
                        </h1>
                        <p class="text-gray-600 mt-1">브라우저 캐시를 완전히 삭제하여 최신 파일이 로드되도록 합니다</p>
                    </div>
                    <div class="text-right">
                        <div class="text-sm text-gray-500">경산다육식물농장</div>
                        <div class="text-xs text-gray-400">캐시 관리 v1.0</div>
                    </div>
                </div>
            </div>

            <!-- 캐시 상태 -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">
                    <i class="fas fa-info-circle text-blue-600 mr-2"></i>
                    현재 캐시 상태
                </h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="text-sm font-medium text-blue-600">Service Worker</div>
                                <div id="sw-status" class="text-lg font-bold text-blue-800">확인중...</div>
                            </div>
                            <i class="fas fa-cogs text-blue-600 text-2xl"></i>
                        </div>
                    </div>
                    
                    <div class="bg-green-50 p-4 rounded-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="text-sm font-medium text-green-600">브라우저 캐시</div>
                                <div id="cache-status" class="text-lg font-bold text-green-800">확인중...</div>
                            </div>
                            <i class="fas fa-database text-green-600 text-2xl"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 캐시 무효화 도구 -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">
                    <i class="fas fa-tools text-orange-600 mr-2"></i>
                    캐시 무효화 도구
                </h2>
                
                <div class="space-y-4">
                    <div class="flex items-center justify-between p-4 bg-red-50 border border-red-200 rounded-lg">
                        <div>
                            <div class="font-medium text-red-800">Service Worker 제거</div>
                            <div class="text-sm text-red-600">등록된 모든 Service Worker를 제거합니다</div>
                        </div>
                        <button onclick="clearServiceWorkers()" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors">
                            <i class="fas fa-trash mr-2"></i>제거
                        </button>
                    </div>
                    
                    <div class="flex items-center justify-between p-4 bg-orange-50 border border-orange-200 rounded-lg">
                        <div>
                            <div class="font-medium text-orange-800">브라우저 캐시 삭제</div>
                            <div class="text-sm text-orange-600">모든 브라우저 캐시를 삭제합니다</div>
                        </div>
                        <button onclick="clearBrowserCache()" class="px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors">
                            <i class="fas fa-broom mr-2"></i>삭제
                        </button>
                    </div>
                    
                    <div class="flex items-center justify-between p-4 bg-purple-50 border border-purple-200 rounded-lg">
                        <div>
                            <div class="font-medium text-purple-800">LocalStorage 정리</div>
                            <div class="text-sm text-purple-600">캐시 관련 LocalStorage 데이터를 정리합니다</div>
                        </div>
                        <button onclick="clearLocalStorage()" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors">
                            <i class="fas fa-eraser mr-2"></i>정리
                        </button>
                    </div>
                    
                    <div class="flex items-center justify-between p-4 bg-blue-50 border border-blue-200 rounded-lg">
                        <div>
                            <div class="font-medium text-blue-800">전체 캐시 무효화</div>
                            <div class="text-sm text-blue-600">모든 캐시를 한번에 무효화합니다</div>
                        </div>
                        <button onclick="clearAllCache()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                            <i class="fas fa-magic mr-2"></i>전체 무효화
                        </button>
                    </div>
                </div>
            </div>

            <!-- 새로고침 안내 -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">
                    <i class="fas fa-refresh text-green-600 mr-2"></i>
                    새로고침 안내
                </h2>
                
                <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                    <div class="flex items-start">
                        <i class="fas fa-lightbulb text-green-600 text-xl mr-3 mt-1"></i>
                        <div>
                            <h3 class="font-medium text-green-800 mb-2">캐시 무효화 후 새로고침 방법</h3>
                            <div class="space-y-2 text-sm text-green-700">
                                <div><strong>일반 새로고침:</strong> F5 키 또는 새로고침 버튼</div>
                                <div><strong>강제 새로고침:</strong> Ctrl + Shift + R (Windows) 또는 Cmd + Shift + R (Mac)</div>
                                <div><strong>완전 새로고침:</strong> 개발자 도구(F12) → Network 탭 → "Disable cache" 체크</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 로그 -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">
                    <i class="fas fa-terminal text-gray-600 mr-2"></i>
                    캐시 무효화 로그
                </h2>
                <div id="log-container" class="bg-gray-900 text-green-400 p-4 rounded-lg font-mono text-sm h-64 overflow-y-auto">
                    <div class="text-gray-500">캐시 무효화 도구가 준비되었습니다...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 로그 함수
        function log(message, type = 'info') {
            const logContainer = document.getElementById('log-container');
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                info: 'text-blue-400',
                success: 'text-green-400',
                warning: 'text-yellow-400',
                error: 'text-red-400'
            };
            
            const logEntry = document.createElement('div');
            logEntry.className = colors[type] || 'text-gray-400';
            logEntry.innerHTML = `[${timestamp}] ${message}`;
            
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        // 캐시 상태 확인
        function checkCacheStatus() {
            // Service Worker 상태 확인
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.getRegistrations().then(function(registrations) {
                    const swStatus = document.getElementById('sw-status');
                    if (registrations.length > 0) {
                        swStatus.textContent = `${registrations.length}개 등록됨`;
                        swStatus.className = 'text-lg font-bold text-red-800';
                    } else {
                        swStatus.textContent = '등록되지 않음';
                        swStatus.className = 'text-lg font-bold text-green-800';
                    }
                });
            } else {
                document.getElementById('sw-status').textContent = '지원되지 않음';
            }

            // 브라우저 캐시 상태 확인
            if ('caches' in window) {
                caches.keys().then(function(cacheNames) {
                    const cacheStatus = document.getElementById('cache-status');
                    if (cacheNames.length > 0) {
                        cacheStatus.textContent = `${cacheNames.length}개 캐시`;
                        cacheStatus.className = 'text-lg font-bold text-orange-800';
                    } else {
                        cacheStatus.textContent = '캐시 없음';
                        cacheStatus.className = 'text-lg font-bold text-green-800';
                    }
                });
            } else {
                document.getElementById('cache-status').textContent = '지원되지 않음';
            }
        }

        // Service Worker 제거
        function clearServiceWorkers() {
            log('Service Worker 제거 시작...', 'info');
            
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.getRegistrations().then(function(registrations) {
                    if (registrations.length === 0) {
                        log('제거할 Service Worker가 없습니다.', 'warning');
                        return;
                    }
                    
                    return Promise.all(
                        registrations.map(function(registration) {
                            log(`Service Worker 제거: ${registration.scope}`, 'info');
                            return registration.unregister();
                        })
                    );
                }).then(function() {
                    log('모든 Service Worker가 제거되었습니다.', 'success');
                    checkCacheStatus();
                }).catch(function(error) {
                    log(`Service Worker 제거 실패: ${error.message}`, 'error');
                });
            } else {
                log('Service Worker를 지원하지 않는 브라우저입니다.', 'warning');
            }
        }

        // 브라우저 캐시 삭제
        function clearBrowserCache() {
            log('브라우저 캐시 삭제 시작...', 'info');
            
            if ('caches' in window) {
                caches.keys().then(function(cacheNames) {
                    if (cacheNames.length === 0) {
                        log('삭제할 캐시가 없습니다.', 'warning');
                        return;
                    }
                    
                    return Promise.all(
                        cacheNames.map(function(cacheName) {
                            log(`캐시 삭제: ${cacheName}`, 'info');
                            return caches.delete(cacheName);
                        })
                    );
                }).then(function() {
                    log('모든 브라우저 캐시가 삭제되었습니다.', 'success');
                    checkCacheStatus();
                }).catch(function(error) {
                    log(`캐시 삭제 실패: ${error.message}`, 'error');
                });
            } else {
                log('브라우저 캐시를 지원하지 않는 브라우저입니다.', 'warning');
            }
        }

        // LocalStorage 정리
        function clearLocalStorage() {
            log('LocalStorage 정리 시작...', 'info');
            
            const cacheKeys = [
                'systemLoadingIssue',
                'apiMode',
                'lastUpdateCheck',
                'pwa-install-prompt',
                'app-version'
            ];
            
            let clearedCount = 0;
            cacheKeys.forEach(key => {
                if (localStorage.getItem(key)) {
                    localStorage.removeItem(key);
                    log(`LocalStorage 정리: ${key}`, 'info');
                    clearedCount++;
                }
            });
            
            if (clearedCount > 0) {
                log(`${clearedCount}개의 LocalStorage 항목이 정리되었습니다.`, 'success');
            } else {
                log('정리할 LocalStorage 항목이 없습니다.', 'warning');
            }
        }

        // 전체 캐시 무효화
        function clearAllCache() {
            log('전체 캐시 무효화 시작...', 'info');
            
            clearServiceWorkers();
            setTimeout(() => {
                clearBrowserCache();
                setTimeout(() => {
                    clearLocalStorage();
                    setTimeout(() => {
                        log('전체 캐시 무효화가 완료되었습니다!', 'success');
                        log('이제 일반 새로고침(F5)으로도 최신 파일이 로드됩니다.', 'success');
                        checkCacheStatus();
                    }, 500);
                }, 500);
            }, 500);
        }

        // 페이지 로드 시 초기화
        document.addEventListener('DOMContentLoaded', function() {
            checkCacheStatus();
            log('캐시 무효화 도구가 준비되었습니다.', 'success');
        });
    </script>
</body>
</html>
