<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸš¨ ê¸´ê¸‰ ì‹œìŠ¤í…œ ë¡œë”© ì˜¤ë¥˜ í•´ê²° - ê²½ì‚°ë‹¤ìœ¡ì‹ë¬¼ë†ì¥</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .fix-button {
            transition: all 0.3s ease;
            transform: scale(1);
        }
        .fix-button:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        .emergency-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        .loading-dots {
            animation: dots 1.5s infinite;
        }
        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60% { content: '...'; }
            80%, 100% { content: ''; }
        }
    </style>
</head>
<body class="bg-red-50 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- ê¸´ê¸‰ ì•Œë¦¼ í—¤ë” -->
        <div class="bg-red-600 text-white p-6 rounded-xl shadow-lg mb-8 emergency-pulse">
            <div class="text-center">
                <div class="text-4xl mb-4">ğŸš¨</div>
                <h1 class="text-3xl font-bold mb-2">ì‹œìŠ¤í…œ ë¡œë”© ì˜¤ë¥˜ ê°ì§€!</h1>
                <p class="text-xl">ê²½ì‚°ë‹¤ìœ¡ì‹ë¬¼ë†ì¥ ê´€ë¦¬ì‹œìŠ¤í…œ ê¸´ê¸‰ ë³µêµ¬ ì¤‘...</p>
            </div>
        </div>

        <!-- ì¦‰ì‹œ í•´ê²° ë²„íŠ¼ë“¤ -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <!-- 1ë‹¨ê³„: ìºì‹œ ê°•ì œ ì‚­ì œ -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-xl font-bold text-red-600 mb-4">ğŸ—‘ï¸ 1ë‹¨ê³„: ìºì‹œ ê°•ì œ ì‚­ì œ</h2>
                <p class="text-gray-600 mb-4">ë¸Œë¼ìš°ì € ìºì‹œì™€ ì„œë¹„ìŠ¤ì›Œì»¤ë¥¼ ì™„ì „íˆ ì‚­ì œí•©ë‹ˆë‹¤.</p>
                <button onclick="forceClearCache()" 
                    class="fix-button w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-lg">
                    ğŸ’¥ ìºì‹œ ê°•ì œ ì‚­ì œ ì‹¤í–‰
                </button>
                <div id="cacheStatus" class="mt-3 text-sm"></div>
            </div>

            <!-- 2ë‹¨ê³„: ì„œë¹„ìŠ¤ì›Œì»¤ ì¬ë“±ë¡ -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-xl font-bold text-orange-600 mb-4">ğŸ”„ 2ë‹¨ê³„: ì„œë¹„ìŠ¤ì›Œì»¤ ì¬ë“±ë¡</h2>
                <p class="text-gray-600 mb-4">ì„œë¹„ìŠ¤ì›Œì»¤ë¥¼ ì™„ì „íˆ ì œê±°í•˜ê³  ìƒˆë¡œ ë“±ë¡í•©ë‹ˆë‹¤.</p>
                <button onclick="reregisterServiceWorker()" 
                    class="fix-button w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-3 px-6 rounded-lg">
                    ğŸ”§ ì„œë¹„ìŠ¤ì›Œì»¤ ì¬ë“±ë¡
                </button>
                <div id="swStatus" class="mt-3 text-sm"></div>
            </div>

            <!-- 3ë‹¨ê³„: ë©”ì¸ ì‹œìŠ¤í…œ ê°•ì œ ë¡œë“œ -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-xl font-bold text-blue-600 mb-4">âš¡ 3ë‹¨ê³„: ë©”ì¸ ì‹œìŠ¤í…œ ê°•ì œ ë¡œë“œ</h2>
                <p class="text-gray-600 mb-4">ë©”ì¸ ì‹œìŠ¤í…œì„ ê°•ì œë¡œ ë‹¤ì‹œ ë¡œë“œí•©ë‹ˆë‹¤.</p>
                <button onclick="forceReloadMainSystem()" 
                    class="fix-button w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg">
                    ğŸš€ ë©”ì¸ ì‹œìŠ¤í…œ ê°•ì œ ë¡œë“œ
                </button>
                <div id="systemStatus" class="mt-3 text-sm"></div>
            </div>

            <!-- 4ë‹¨ê³„: ì™„ì „ ë³µêµ¬ -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-xl font-bold text-green-600 mb-4">âœ… 4ë‹¨ê³„: ì™„ì „ ë³µêµ¬</h2>
                <p class="text-gray-600 mb-4">ëª¨ë“  ë‹¨ê³„ë¥¼ í•œ ë²ˆì— ì‹¤í–‰í•˜ì—¬ ì™„ì „íˆ ë³µêµ¬í•©ë‹ˆë‹¤.</p>
                <button onclick="completeRecovery()" 
                    class="fix-button w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg">
                    ğŸ¯ ì™„ì „ ë³µêµ¬ ì‹¤í–‰
                </button>
                <div id="recoveryStatus" class="mt-3 text-sm"></div>
            </div>
        </div>

        <!-- ì‹¤ì‹œê°„ ì§„í–‰ ìƒí™© -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <h2 class="text-xl font-bold mb-4">ğŸ“Š ì‹¤ì‹œê°„ ì§„í–‰ ìƒí™©</h2>
            <div id="progressArea" class="space-y-3">
                <div class="text-gray-600">ë³µêµ¬ ë‹¨ê³„ë¥¼ ì„ íƒí•˜ì—¬ ì§„í–‰í•˜ì„¸ìš”.</div>
            </div>
        </div>

        <!-- ìˆ˜ë™ í•´ê²° ë°©ë²• -->
        <div class="bg-yellow-50 border border-yellow-200 rounded-xl p-6">
            <h2 class="text-xl font-bold text-yellow-800 mb-4">ğŸ”§ ìˆ˜ë™ í•´ê²° ë°©ë²•</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                <div>
                    <h3 class="font-bold text-yellow-700 mb-2">ë¸Œë¼ìš°ì €ë³„ ìºì‹œ ì‚­ì œ:</h3>
                    <ul class="space-y-1 text-yellow-700">
                        <li>â€¢ Chrome: Ctrl+Shift+Delete</li>
                        <li>â€¢ Firefox: Ctrl+Shift+Delete</li>
                        <li>â€¢ Safari: Cmd+Option+E</li>
                        <li>â€¢ Edge: Ctrl+Shift+Delete</li>
                    </ul>
                </div>
                <div>
                    <h3 class="font-bold text-yellow-700 mb-2">ê°œë°œì ë„êµ¬ ë°©ë²•:</h3>
                    <ul class="space-y-1 text-yellow-700">
                        <li>â€¢ F12 â†’ Application â†’ Storage</li>
                        <li>â€¢ Clear site data í´ë¦­</li>
                        <li>â€¢ Service Workers â†’ Unregister</li>
                        <li>â€¢ ìƒˆë¡œê³ ì¹¨ (Ctrl+F5)</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        console.log('ğŸš¨ ê¸´ê¸‰ ì‹œìŠ¤í…œ ë³µêµ¬ ë„êµ¬ ì‹œì‘...');

        // ì§„í–‰ ìƒí™© í‘œì‹œ
        function showProgress(message, type = 'info') {
            const progressArea = document.getElementById('progressArea');
            const timestamp = new Date().toLocaleTimeString();
            
            const colors = {
                'info': 'text-blue-600',
                'success': 'text-green-600',
                'warning': 'text-yellow-600',
                'error': 'text-red-600'
            };
            
            const icons = {
                'info': 'ğŸ”„',
                'success': 'âœ…',
                'warning': 'âš ï¸',
                'error': 'âŒ'
            };
            
            const progressItem = document.createElement('div');
            progressItem.className = `p-3 bg-gray-50 rounded-lg ${colors[type]}`;
            progressItem.innerHTML = `
                <div class="flex items-center">
                    <span class="text-lg mr-2">${icons[type]}</span>
                    <div>
                        <div class="font-medium">${message}</div>
                        <div class="text-xs text-gray-500">${timestamp}</div>
                    </div>
                </div>
            `;
            
            progressArea.appendChild(progressItem);
            progressArea.scrollTop = progressArea.scrollHeight;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        // 1ë‹¨ê³„: ìºì‹œ ê°•ì œ ì‚­ì œ
        async function forceClearCache() {
            const statusDiv = document.getElementById('cacheStatus');
            statusDiv.innerHTML = '<div class="text-blue-600">ğŸ”„ ìºì‹œ ì‚­ì œ ì¤‘...</div>';
            
            showProgress('1ë‹¨ê³„: ìºì‹œ ê°•ì œ ì‚­ì œ ì‹œì‘', 'info');
            
            try {
                // ëª¨ë“  ìºì‹œ ì‚­ì œ
                const cacheNames = await caches.keys();
                showProgress(`ë°œê²¬ëœ ìºì‹œ: ${cacheNames.length}ê°œ`, 'info');
                
                for (const cacheName of cacheNames) {
                    await caches.delete(cacheName);
                    showProgress(`ìºì‹œ ì‚­ì œë¨: ${cacheName}`, 'success');
                }
                
                // localStorage ë° sessionStorage ì‚­ì œ
                localStorage.clear();
                sessionStorage.clear();
                showProgress('Storage ë°ì´í„° ì‚­ì œ ì™„ë£Œ', 'success');
                
                // IndexedDB ì‚­ì œ ì‹œë„
                if ('indexedDB' in window) {
                    try {
                        const databases = await indexedDB.databases();
                        for (const db of databases) {
                            indexedDB.deleteDatabase(db.name);
                            showProgress(`IndexedDB ì‚­ì œ: ${db.name}`, 'success');
                        }
                    } catch (e) {
                        showProgress('IndexedDB ì‚­ì œ ì‹œë„ (ì¼ë¶€ ì œí•œ)', 'warning');
                    }
                }
                
                statusDiv.innerHTML = '<div class="text-green-600">âœ… ìºì‹œ ì‚­ì œ ì™„ë£Œ!</div>';
                showProgress('1ë‹¨ê³„: ìºì‹œ ê°•ì œ ì‚­ì œ ì™„ë£Œ!', 'success');
                
            } catch (error) {
                statusDiv.innerHTML = `<div class="text-red-600">âŒ ì˜¤ë¥˜: ${error.message}</div>`;
                showProgress(`ìºì‹œ ì‚­ì œ ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }

        // 2ë‹¨ê³„: ì„œë¹„ìŠ¤ì›Œì»¤ ì¬ë“±ë¡
        async function reregisterServiceWorker() {
            const statusDiv = document.getElementById('swStatus');
            statusDiv.innerHTML = '<div class="text-blue-600">ğŸ”„ ì„œë¹„ìŠ¤ì›Œì»¤ ì¬ë“±ë¡ ì¤‘...</div>';
            
            showProgress('2ë‹¨ê³„: ì„œë¹„ìŠ¤ì›Œì»¤ ì¬ë“±ë¡ ì‹œì‘', 'info');
            
            try {
                if ('serviceWorker' in navigator) {
                    // ê¸°ì¡´ ì„œë¹„ìŠ¤ì›Œì»¤ ëª¨ë‘ í•´ì œ
                    const registrations = await navigator.serviceWorker.getRegistrations();
                    showProgress(`ë°œê²¬ëœ ì„œë¹„ìŠ¤ì›Œì»¤: ${registrations.length}ê°œ`, 'info');
                    
                    for (const registration of registrations) {
                        await registration.unregister();
                        showProgress('ê¸°ì¡´ ì„œë¹„ìŠ¤ì›Œì»¤ í•´ì œë¨', 'success');
                    }
                    
                    // ì ì‹œ ëŒ€ê¸°
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    // ìƒˆë¡œìš´ ì„œë¹„ìŠ¤ì›Œì»¤ ë“±ë¡
                    const newRegistration = await navigator.serviceWorker.register('sw.js', {
                        scope: './',
                        updateViaCache: 'none'
                    });
                    
                    showProgress('ìƒˆ ì„œë¹„ìŠ¤ì›Œì»¤ ë“±ë¡ ì™„ë£Œ', 'success');
                    statusDiv.innerHTML = '<div class="text-green-600">âœ… ì„œë¹„ìŠ¤ì›Œì»¤ ì¬ë“±ë¡ ì™„ë£Œ!</div>';
                    showProgress('2ë‹¨ê³„: ì„œë¹„ìŠ¤ì›Œì»¤ ì¬ë“±ë¡ ì™„ë£Œ!', 'success');
                    
                } else {
                    statusDiv.innerHTML = '<div class="text-yellow-600">âš ï¸ ì„œë¹„ìŠ¤ì›Œì»¤ ë¯¸ì§€ì› ë¸Œë¼ìš°ì €</div>';
                    showProgress('ì„œë¹„ìŠ¤ì›Œì»¤ ë¯¸ì§€ì› ë¸Œë¼ìš°ì €', 'warning');
                }
                
            } catch (error) {
                statusDiv.innerHTML = `<div class="text-red-600">âŒ ì˜¤ë¥˜: ${error.message}</div>`;
                showProgress(`ì„œë¹„ìŠ¤ì›Œì»¤ ì¬ë“±ë¡ ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }

        // 3ë‹¨ê³„: ë©”ì¸ ì‹œìŠ¤í…œ ê°•ì œ ë¡œë“œ
        async function forceReloadMainSystem() {
            const statusDiv = document.getElementById('systemStatus');
            statusDiv.innerHTML = '<div class="text-blue-600">ğŸ”„ ë©”ì¸ ì‹œìŠ¤í…œ ë¡œë“œ ì¤‘...</div>';
            
            showProgress('3ë‹¨ê³„: ë©”ì¸ ì‹œìŠ¤í…œ ê°•ì œ ë¡œë“œ ì‹œì‘', 'info');
            
            try {
                // í˜„ì¬ í˜ì´ì§€ì—ì„œ ë©”ì¸ ì‹œìŠ¤í…œ ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì‹œë„
                const script = document.createElement('script');
                script.src = 'js/app.js?' + Date.now(); // ìºì‹œ ë²„ìŠ¤íŒ…
                script.onload = () => {
                    showProgress('ë©”ì¸ ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì„±ê³µ', 'success');
                    
                    // OrderManagementSystem ì´ˆê¸°í™” ì‹œë„
                    setTimeout(() => {
                        if (typeof OrderManagementSystem !== 'undefined') {
                            try {
                                window.orderSystem = new OrderManagementSystem();
                                showProgress('OrderManagementSystem ì´ˆê¸°í™” ì„±ê³µ', 'success');
                                statusDiv.innerHTML = '<div class="text-green-600">âœ… ë©”ì¸ ì‹œìŠ¤í…œ ë¡œë“œ ì™„ë£Œ!</div>';
                                showProgress('3ë‹¨ê³„: ë©”ì¸ ì‹œìŠ¤í…œ ê°•ì œ ë¡œë“œ ì™„ë£Œ!', 'success');
                            } catch (error) {
                                showProgress(`ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì˜¤ë¥˜: ${error.message}`, 'error');
                                statusDiv.innerHTML = `<div class="text-red-600">âŒ ì´ˆê¸°í™” ì˜¤ë¥˜: ${error.message}</div>`;
                            }
                        } else {
                            showProgress('OrderManagementSystem í´ë˜ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ', 'warning');
                            statusDiv.innerHTML = '<div class="text-yellow-600">âš ï¸ ì‹œìŠ¤í…œ í´ë˜ìŠ¤ ë¯¸ë°œê²¬</div>';
                        }
                    }, 1000);
                };
                
                script.onerror = () => {
                    showProgress('ë©”ì¸ ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì‹¤íŒ¨', 'error');
                    statusDiv.innerHTML = '<div class="text-red-600">âŒ ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì‹¤íŒ¨</div>';
                };
                
                document.head.appendChild(script);
                
            } catch (error) {
                statusDiv.innerHTML = `<div class="text-red-600">âŒ ì˜¤ë¥˜: ${error.message}</div>`;
                showProgress(`ë©”ì¸ ì‹œìŠ¤í…œ ë¡œë“œ ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }

        // 4ë‹¨ê³„: ì™„ì „ ë³µêµ¬
        async function completeRecovery() {
            const statusDiv = document.getElementById('recoveryStatus');
            statusDiv.innerHTML = '<div class="text-blue-600">ğŸ”„ ì™„ì „ ë³µêµ¬ ì§„í–‰ ì¤‘...</div>';
            
            showProgress('ğŸ¯ ì™„ì „ ë³µêµ¬ ì‹œì‘! ëª¨ë“  ë‹¨ê³„ ì‹¤í–‰', 'info');
            
            try {
                // 1ë‹¨ê³„: ìºì‹œ ì‚­ì œ
                await forceClearCache();
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // 2ë‹¨ê³„: ì„œë¹„ìŠ¤ì›Œì»¤ ì¬ë“±ë¡
                await reregisterServiceWorker();
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                // 3ë‹¨ê³„: ë©”ì¸ ì‹œìŠ¤í…œ ë¡œë“œ
                await forceReloadMainSystem();
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                // ìµœì¢… ê²€ì¦
                showProgress('ìµœì¢… ì‹œìŠ¤í…œ ìƒíƒœ ê²€ì¦ ì¤‘...', 'info');
                
                if (window.orderSystem && typeof window.orderSystem === 'object') {
                    showProgress('ğŸ‰ ì™„ì „ ë³µêµ¬ ì„±ê³µ! ì‹œìŠ¤í…œì´ ì •ìƒ ì‘ë™í•©ë‹ˆë‹¤.', 'success');
                    statusDiv.innerHTML = '<div class="text-green-600">ğŸ‰ ì™„ì „ ë³µêµ¬ ì„±ê³µ!</div>';
                    
                    // 3ì´ˆ í›„ ë©”ì¸ í˜ì´ì§€ë¡œ ì´ë™
                    setTimeout(() => {
                        if (confirm('ë³µêµ¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ë©”ì¸ í˜ì´ì§€ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                            window.location.href = 'index.html';
                        }
                    }, 3000);
                    
                } else {
                    showProgress('âš ï¸ ë³µêµ¬ ì™„ë£Œ, í•˜ì§€ë§Œ ìˆ˜ë™ ìƒˆë¡œê³ ì¹¨ í•„ìš”', 'warning');
                    statusDiv.innerHTML = '<div class="text-yellow-600">âš ï¸ ìˆ˜ë™ ìƒˆë¡œê³ ì¹¨ í•„ìš”</div>';
                    
                    setTimeout(() => {
                        if (confirm('ë³µêµ¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                            window.location.reload(true);
                        }
                    }, 2000);
                }
                
            } catch (error) {
                showProgress(`ì™„ì „ ë³µêµ¬ ì˜¤ë¥˜: ${error.message}`, 'error');
                statusDiv.innerHTML = `<div class="text-red-600">âŒ ë³µêµ¬ ì˜¤ë¥˜: ${error.message}</div>`;
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì§„ë‹¨
        window.addEventListener('load', function() {
            showProgress('ğŸš¨ ê¸´ê¸‰ ë³µêµ¬ ë„êµ¬ ì¤€ë¹„ ì™„ë£Œ', 'info');
            showProgress('ì‹œìŠ¤í…œ ë¡œë”© ì˜¤ë¥˜ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•œ ë‹¨ê³„ë¥¼ ì„ íƒí•˜ì„¸ìš”', 'info');
            
            // í˜„ì¬ ìƒíƒœ ê°„ë‹¨ ì²´í¬
            setTimeout(() => {
                const hasServiceWorker = 'serviceWorker' in navigator;
                const hasCaches = 'caches' in window;
                const isOnline = navigator.onLine;
                
                showProgress(`í™˜ê²½ ì²´í¬: SW=${hasServiceWorker}, Cache=${hasCaches}, Online=${isOnline}`, 'info');
                
                if (!isOnline) {
                    showProgress('âš ï¸ ì˜¤í”„ë¼ì¸ ìƒíƒœì…ë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•˜ì„¸ìš”.', 'warning');
                }
            }, 1000);
        });
    </script>
</body>
</html>