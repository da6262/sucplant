<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>이벤트 리스너 복구 도구 - 경산다육식물농장</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <div class="max-w-4xl mx-auto">
            <!-- 헤더 -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-2xl font-bold text-gray-800">
                            <i class="fas fa-mouse-pointer text-yellow-600 mr-2"></i>
                            이벤트 리스너 복구 도구
                        </h1>
                        <p class="text-gray-600 mt-1">F5 새로고침 후 아이콘이 비활성화되는 문제를 해결합니다</p>
                    </div>
                    <div class="text-right">
                        <div class="text-sm text-gray-500">경산다육식물농장</div>
                        <div class="text-xs text-gray-400">이벤트 관리 v1.0</div>
                    </div>
                </div>
            </div>

            <!-- 문제 설명 -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">
                    <i class="fas fa-exclamation-triangle text-red-600 mr-2"></i>
                    문제 상황
                </h2>
                
                <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                    <div class="flex items-start">
                        <i class="fas fa-bug text-red-600 text-xl mr-3 mt-1"></i>
                        <div>
                            <h3 class="font-medium text-red-800 mb-2">F5 새로고침 후 아이콘 비활성화</h3>
                            <div class="space-y-2 text-sm text-red-700">
                                <div>• <strong>증상:</strong> F5 새로고침 후 화면의 아이콘을 클릭해도 반응하지 않음</div>
                                <div>• <strong>원인:</strong> JavaScript 이벤트 리스너가 제대로 등록되지 않음</div>
                                <div>• <strong>해결:</strong> Ctrl+Shift+R 강제 새로고침 또는 이 도구 사용</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 이벤트 상태 확인 -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">
                    <i class="fas fa-search text-blue-600 mr-2"></i>
                    이벤트 리스너 상태 확인
                </h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="text-sm font-medium text-blue-600">주소 검색 버튼</div>
                                <div id="address-btn-status" class="text-lg font-bold text-blue-800">확인중...</div>
                            </div>
                            <i class="fas fa-map-marker-alt text-blue-600 text-2xl"></i>
                        </div>
                    </div>
                    
                    <div class="bg-green-50 p-4 rounded-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="text-sm font-medium text-green-600">고객 자동완성</div>
                                <div id="autocomplete-status" class="text-lg font-bold text-green-800">확인중...</div>
                            </div>
                            <i class="fas fa-user text-green-600 text-2xl"></i>
                        </div>
                    </div>
                    
                    <div class="bg-purple-50 p-4 rounded-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="text-sm font-medium text-purple-600">주문 폼</div>
                                <div id="order-form-status" class="text-lg font-bold text-purple-800">확인중...</div>
                            </div>
                            <i class="fas fa-shopping-cart text-purple-600 text-2xl"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 복구 도구 -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">
                    <i class="fas fa-tools text-orange-600 mr-2"></i>
                    이벤트 리스너 복구 도구
                </h2>
                
                <div class="space-y-4">
                    <div class="flex items-center justify-between p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                        <div>
                            <div class="font-medium text-yellow-800">이벤트 리스너 재등록</div>
                            <div class="text-sm text-yellow-600">모든 이벤트 리스너를 다시 등록합니다</div>
                        </div>
                        <button onclick="reinitializeEventListeners()" class="px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors">
                            <i class="fas fa-sync-alt mr-2"></i>재등록
                        </button>
                    </div>
                    
                    <div class="flex items-center justify-between p-4 bg-blue-50 border border-blue-200 rounded-lg">
                        <div>
                            <div class="font-medium text-blue-800">카카오 주소 검색 복구</div>
                            <div class="text-sm text-blue-600">주소 검색 버튼 이벤트를 복구합니다</div>
                        </div>
                        <button onclick="fixKakaoAddressSearch()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                            <i class="fas fa-map-marker-alt mr-2"></i>복구
                        </button>
                    </div>
                    
                    <div class="flex items-center justify-between p-4 bg-green-50 border border-green-200 rounded-lg">
                        <div>
                            <div class="font-medium text-green-800">고객 자동완성 복구</div>
                            <div class="text-sm text-green-600">고객 이름 자동완성 기능을 복구합니다</div>
                        </div>
                        <button onclick="fixCustomerAutocomplete()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                            <i class="fas fa-user mr-2"></i>복구
                        </button>
                    </div>
                    
                    <div class="flex items-center justify-between p-4 bg-purple-50 border border-purple-200 rounded-lg">
                        <div>
                            <div class="font-medium text-purple-800">전체 시스템 복구</div>
                            <div class="text-sm text-purple-600">데이터 복구 + 이벤트 리스너 재등록</div>
                        </div>
                        <button onclick="fullSystemRecovery()" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors">
                            <i class="fas fa-magic mr-2"></i>전체 복구
                        </button>
                    </div>
                </div>
            </div>

            <!-- 사용법 안내 -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">
                    <i class="fas fa-info-circle text-indigo-600 mr-2"></i>
                    사용법 안내
                </h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="bg-indigo-50 border border-indigo-200 rounded-lg p-4">
                        <h3 class="font-medium text-indigo-800 mb-2">자동 해결</h3>
                        <div class="text-sm text-indigo-700 space-y-1">
                            <div>1. F5 새로고침 후 아이콘이 비활성화됨</div>
                            <div>2. 🔄 버튼 클릭 (이벤트 리스너 재등록)</div>
                            <div>3. 아이콘이 정상 작동함</div>
                        </div>
                    </div>
                    
                    <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                        <h3 class="font-medium text-green-800 mb-2">수동 해결</h3>
                        <div class="text-sm text-green-700 space-y-1">
                            <div>1. 이 페이지에서 상태 확인</div>
                            <div>2. 필요한 복구 도구 실행</div>
                            <div>3. 메인 페이지로 돌아가서 확인</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 로그 -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">
                    <i class="fas fa-terminal text-gray-600 mr-2"></i>
                    복구 로그
                </h2>
                <div id="log-container" class="bg-gray-900 text-green-400 p-4 rounded-lg font-mono text-sm h-64 overflow-y-auto">
                    <div class="text-gray-500">이벤트 리스너 복구 도구가 준비되었습니다...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 로그 함수
        function log(message, type = 'info') {
            const logContainer = document.getElementById('log-container');
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                info: 'text-blue-400',
                success: 'text-green-400',
                warning: 'text-yellow-400',
                error: 'text-red-400'
            };
            
            const logEntry = document.createElement('div');
            logEntry.className = colors[type] || 'text-gray-400';
            logEntry.innerHTML = `[${timestamp}] ${message}`;
            
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        // 이벤트 리스너 상태 확인
        function checkEventStatus() {
            // 주소 검색 버튼 상태 확인
            const addressBtn = document.getElementById('customer-form-address-search');
            const addressStatus = document.getElementById('address-btn-status');
            if (addressBtn) {
                addressStatus.textContent = '등록됨';
                addressStatus.className = 'text-lg font-bold text-green-800';
            } else {
                addressStatus.textContent = '없음';
                addressStatus.className = 'text-lg font-bold text-red-800';
            }

            // 고객 자동완성 상태 확인
            const customerName = document.getElementById('customer-name');
            const autocompleteStatus = document.getElementById('autocomplete-status');
            if (customerName) {
                autocompleteStatus.textContent = '등록됨';
                autocompleteStatus.className = 'text-lg font-bold text-green-800';
            } else {
                autocompleteStatus.textContent = '없음';
                autocompleteStatus.className = 'text-lg font-bold text-red-800';
            }

            // 주문 폼 상태 확인
            const orderForm = document.getElementById('order-form');
            const orderFormStatus = document.getElementById('order-form-status');
            if (orderForm) {
                orderFormStatus.textContent = '등록됨';
                orderFormStatus.className = 'text-lg font-bold text-green-800';
            } else {
                orderFormStatus.textContent = '없음';
                orderFormStatus.className = 'text-lg font-bold text-red-800';
            }
        }

        // 이벤트 리스너 재등록
        function reinitializeEventListeners() {
            log('이벤트 리스너 재등록 시작...', 'info');
            
            if (typeof orderSystem !== 'undefined') {
                orderSystem.reinitializeEventListeners();
                log('이벤트 리스너 재등록 완료', 'success');
                checkEventStatus();
            } else {
                log('orderSystem이 로드되지 않았습니다. 메인 페이지에서 실행해주세요.', 'error');
            }
        }

        // 카카오 주소 검색 복구
        function fixKakaoAddressSearch() {
            log('카카오 주소 검색 복구 시작...', 'info');
            
            if (typeof orderSystem !== 'undefined') {
                orderSystem.setupKakaoAddressSearch();
                log('카카오 주소 검색 복구 완료', 'success');
                checkEventStatus();
            } else {
                log('orderSystem이 로드되지 않았습니다.', 'error');
            }
        }

        // 고객 자동완성 복구
        function fixCustomerAutocomplete() {
            log('고객 자동완성 복구 시작...', 'info');
            
            if (typeof orderSystem !== 'undefined') {
                orderSystem.setupCustomerAutocomplete();
                log('고객 자동완성 복구 완료', 'success');
                checkEventStatus();
            } else {
                log('orderSystem이 로드되지 않았습니다.', 'error');
            }
        }

        // 전체 시스템 복구
        function fullSystemRecovery() {
            log('전체 시스템 복구 시작...', 'info');
            
            if (typeof orderSystem !== 'undefined') {
                // 데이터 복구
                orderSystem.emergencyDataRecovery();
                
                // 이벤트 리스너 재등록
                setTimeout(() => {
                    orderSystem.reinitializeEventListeners();
                    log('전체 시스템 복구 완료', 'success');
                    checkEventStatus();
                }, 1000);
            } else {
                log('orderSystem이 로드되지 않았습니다.', 'error');
            }
        }

        // 페이지 로드 시 초기화
        document.addEventListener('DOMContentLoaded', function() {
            checkEventStatus();
            log('이벤트 리스너 복구 도구가 준비되었습니다.', 'success');
        });
    </script>
</body>
</html>
