<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>데이터 복구 도구 - 경산다육식물농장</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <div class="max-w-4xl mx-auto">
            <!-- 헤더 -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-2xl font-bold text-gray-800">
                            <i class="fas fa-database text-green-600 mr-2"></i>
                            데이터 복구 도구
                        </h1>
                        <p class="text-gray-600 mt-1">F5 새로고침으로 사라진 주문 데이터를 복구합니다</p>
                    </div>
                    <div class="text-right">
                        <div class="text-sm text-gray-500">경산다육식물농장</div>
                        <div class="text-xs text-gray-400">관리시스템 v1.0</div>
                    </div>
                </div>
            </div>

            <!-- 데이터 상태 확인 -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">
                    <i class="fas fa-search text-blue-600 mr-2"></i>
                    LocalStorage 데이터 상태
                </h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="text-sm font-medium text-gray-600">주문 데이터</div>
                                <div id="orders-count" class="text-2xl font-bold text-gray-800">-</div>
                            </div>
                            <i class="fas fa-shopping-cart text-blue-600 text-2xl"></i>
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="text-sm font-medium text-gray-600">고객 데이터</div>
                                <div id="customers-count" class="text-2xl font-bold text-gray-800">-</div>
                            </div>
                            <i class="fas fa-users text-green-600 text-2xl"></i>
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="text-sm font-medium text-gray-600">상품 데이터</div>
                                <div id="products-count" class="text-2xl font-bold text-gray-800">-</div>
                            </div>
                            <i class="fas fa-box text-purple-600 text-2xl"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 복구 도구 -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">
                    <i class="fas fa-tools text-orange-600 mr-2"></i>
                    데이터 복구 도구
                </h2>
                
                <div class="space-y-4">
                    <div class="flex items-center justify-between p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                        <div>
                            <div class="font-medium text-yellow-800">주문 데이터 복구</div>
                            <div class="text-sm text-yellow-600">LocalStorage에서 주문 데이터를 복구합니다</div>
                        </div>
                        <button onclick="recoverOrders()" class="px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors">
                            <i class="fas fa-undo mr-2"></i>복구
                        </button>
                    </div>
                    
                    <div class="flex items-center justify-between p-4 bg-green-50 border border-green-200 rounded-lg">
                        <div>
                            <div class="font-medium text-green-800">고객 데이터 복구</div>
                            <div class="text-sm text-green-600">LocalStorage에서 고객 데이터를 복구합니다</div>
                        </div>
                        <button onclick="recoverCustomers()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                            <i class="fas fa-undo mr-2"></i>복구
                        </button>
                    </div>
                    
                    <div class="flex items-center justify-between p-4 bg-blue-50 border border-blue-200 rounded-lg">
                        <div>
                            <div class="font-medium text-blue-800">전체 데이터 복구</div>
                            <div class="text-sm text-blue-600">모든 데이터를 한번에 복구합니다</div>
                        </div>
                        <button onclick="recoverAllData()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                            <i class="fas fa-magic mr-2"></i>전체 복구
                        </button>
                    </div>
                </div>
            </div>

            <!-- 데이터 백업/복원 -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">
                    <i class="fas fa-download text-indigo-600 mr-2"></i>
                    데이터 백업/복원
                </h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="p-4 bg-indigo-50 border border-indigo-200 rounded-lg">
                        <div class="flex items-center justify-between mb-3">
                            <div class="font-medium text-indigo-800">데이터 백업</div>
                            <i class="fas fa-download text-indigo-600"></i>
                        </div>
                        <div class="text-sm text-indigo-600 mb-3">현재 데이터를 JSON 파일로 다운로드합니다</div>
                        <button onclick="backupData()" class="w-full px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors">
                            <i class="fas fa-file-download mr-2"></i>백업 다운로드
                        </button>
                    </div>
                    
                    <div class="p-4 bg-purple-50 border border-purple-200 rounded-lg">
                        <div class="flex items-center justify-between mb-3">
                            <div class="font-medium text-purple-800">데이터 복원</div>
                            <i class="fas fa-upload text-purple-600"></i>
                        </div>
                        <div class="text-sm text-purple-600 mb-3">백업 파일에서 데이터를 복원합니다</div>
                        <input type="file" id="restore-file" accept=".json" class="hidden" onchange="restoreData(this)">
                        <button onclick="document.getElementById('restore-file').click()" class="w-full px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors">
                            <i class="fas fa-file-upload mr-2"></i>파일 선택
                        </button>
                    </div>
                </div>
            </div>

            <!-- 로그 -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">
                    <i class="fas fa-terminal text-gray-600 mr-2"></i>
                    복구 로그
                </h2>
                <div id="log-container" class="bg-gray-900 text-green-400 p-4 rounded-lg font-mono text-sm h-64 overflow-y-auto">
                    <div class="text-gray-500">복구 도구가 준비되었습니다...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 로그 함수
        function log(message, type = 'info') {
            const logContainer = document.getElementById('log-container');
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                info: 'text-blue-400',
                success: 'text-green-400',
                warning: 'text-yellow-400',
                error: 'text-red-400'
            };
            
            const logEntry = document.createElement('div');
            logEntry.className = colors[type] || 'text-gray-400';
            logEntry.innerHTML = `[${timestamp}] ${message}`;
            
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        // 데이터 상태 확인
        function checkDataStatus() {
            const orders = JSON.parse(localStorage.getItem('farm_management_orders') || '[]');
            const customers = JSON.parse(localStorage.getItem('farm_management_customers') || '[]');
            const products = JSON.parse(localStorage.getItem('farm_management_products') || '[]');
            
            document.getElementById('orders-count').textContent = orders.length;
            document.getElementById('customers-count').textContent = customers.length;
            document.getElementById('products-count').textContent = products.length;
            
            log(`데이터 상태 확인: 주문 ${orders.length}건, 고객 ${customers.length}명, 상품 ${products.length}개`, 'info');
        }

        // 주문 데이터 복구
        function recoverOrders() {
            log('주문 데이터 복구 시작...', 'info');
            
            const orders = JSON.parse(localStorage.getItem('farm_management_orders') || '[]');
            
            if (orders.length === 0) {
                log('복구할 주문 데이터가 없습니다.', 'warning');
                return;
            }
            
            // 메인 시스템에 데이터 복구
            if (typeof orderSystem !== 'undefined') {
                orderSystem.orders = orders;
                orderSystem.renderOrdersTable();
                log(`주문 데이터 복구 완료: ${orders.length}건`, 'success');
            } else {
                log('orderSystem이 로드되지 않았습니다. 메인 페이지에서 실행해주세요.', 'error');
            }
        }

        // 고객 데이터 복구
        function recoverCustomers() {
            log('고객 데이터 복구 시작...', 'info');
            
            const customers = JSON.parse(localStorage.getItem('farm_management_customers') || '[]');
            
            if (customers.length === 0) {
                log('복구할 고객 데이터가 없습니다.', 'warning');
                return;
            }
            
            // 메인 시스템에 데이터 복구
            if (typeof orderSystem !== 'undefined') {
                orderSystem.customers = customers;
                orderSystem.renderCustomersTable();
                log(`고객 데이터 복구 완료: ${customers.length}명`, 'success');
            } else {
                log('orderSystem이 로드되지 않았습니다. 메인 페이지에서 실행해주세요.', 'error');
            }
        }

        // 전체 데이터 복구
        function recoverAllData() {
            log('전체 데이터 복구 시작...', 'info');
            
            const orders = JSON.parse(localStorage.getItem('farm_management_orders') || '[]');
            const customers = JSON.parse(localStorage.getItem('farm_management_customers') || '[]');
            const products = JSON.parse(localStorage.getItem('farm_management_products') || '[]');
            const waitlist = JSON.parse(localStorage.getItem('farm_management_waitlist') || '[]');
            const categories = JSON.parse(localStorage.getItem('farm_management_categories') || '[]');
            
            if (typeof orderSystem !== 'undefined') {
                orderSystem.orders = orders;
                orderSystem.customers = customers;
                orderSystem.products = products;
                orderSystem.waitlist = waitlist;
                orderSystem.categories = categories;
                
                // UI 새로고침
                orderSystem.renderOrdersTable();
                orderSystem.renderCustomersTable();
                orderSystem.renderProductsTable();
                orderSystem.renderWaitlistTable();
                
                log(`전체 데이터 복구 완료: 주문 ${orders.length}건, 고객 ${customers.length}명, 상품 ${products.length}개`, 'success');
            } else {
                log('orderSystem이 로드되지 않았습니다. 메인 페이지에서 실행해주세요.', 'error');
            }
        }

        // 데이터 백업
        function backupData() {
            log('데이터 백업 시작...', 'info');
            
            const data = {
                orders: JSON.parse(localStorage.getItem('farm_management_orders') || '[]'),
                customers: JSON.parse(localStorage.getItem('farm_management_customers') || '[]'),
                products: JSON.parse(localStorage.getItem('farm_management_products') || '[]'),
                waitlist: JSON.parse(localStorage.getItem('farm_management_waitlist') || '[]'),
                categories: JSON.parse(localStorage.getItem('farm_management_categories') || '[]'),
                order_sources: JSON.parse(localStorage.getItem('farm_management_order_sources') || '[]'),
                order_statuses: JSON.parse(localStorage.getItem('farm_management_order_statuses') || '[]'),
                backup_date: new Date().toISOString(),
                version: '1.0'
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `경산다육농장_백업_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            log('데이터 백업 완료', 'success');
        }

        // 데이터 복원
        function restoreData(input) {
            const file = input.files[0];
            if (!file) return;
            
            log('데이터 복원 시작...', 'info');
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    // LocalStorage에 저장
                    localStorage.setItem('farm_management_orders', JSON.stringify(data.orders || []));
                    localStorage.setItem('farm_management_customers', JSON.stringify(data.customers || []));
                    localStorage.setItem('farm_management_products', JSON.stringify(data.products || []));
                    localStorage.setItem('farm_management_waitlist', JSON.stringify(data.waitlist || []));
                    localStorage.setItem('farm_management_categories', JSON.stringify(data.categories || []));
                    localStorage.setItem('farm_management_order_sources', JSON.stringify(data.order_sources || []));
                    localStorage.setItem('farm_management_order_statuses', JSON.stringify(data.order_statuses || []));
                    
                    // 메인 시스템에 로드
                    if (typeof orderSystem !== 'undefined') {
                        orderSystem.orders = data.orders || [];
                        orderSystem.customers = data.customers || [];
                        orderSystem.products = data.products || [];
                        orderSystem.waitlist = data.waitlist || [];
                        orderSystem.categories = data.categories || [];
                        
                        // UI 새로고침
                        orderSystem.renderOrdersTable();
                        orderSystem.renderCustomersTable();
                        orderSystem.renderProductsTable();
                        orderSystem.renderWaitlistTable();
                    }
                    
                    // 상태 업데이트
                    checkDataStatus();
                    
                    log(`데이터 복원 완료: ${data.backup_date || '날짜 미상'}`, 'success');
                } catch (error) {
                    log(`데이터 복원 실패: ${error.message}`, 'error');
                }
            };
            reader.readAsText(file);
        }

        // 페이지 로드 시 초기화
        document.addEventListener('DOMContentLoaded', function() {
            checkDataStatus();
            log('데이터 복구 도구가 준비되었습니다.', 'success');
        });
    </script>
</body>
</html>