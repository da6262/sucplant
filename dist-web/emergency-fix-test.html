<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🚨 긴급 시스템 복구 테스트</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-red-50 p-8">
    <div class="max-w-2xl mx-auto">
        <h1 class="text-2xl font-bold mb-6 text-red-800">🚨 긴급 시스템 로딩 복구 테스트</h1>
        
        <div class="bg-white p-6 rounded-lg shadow border-l-4 border-red-500">
            <h2 class="font-semibold mb-4 text-red-700">시스템 접속 테스트</h2>
            
            <div class="space-y-4">
                <button onclick="testSystemLoading()" class="w-full bg-red-600 hover:bg-red-700 text-white py-3 px-4 rounded-lg font-medium">
                    🔍 시스템 로딩 상태 긴급 확인
                </button>
                
                <button onclick="testBasicFunctions()" class="w-full bg-orange-600 hover:bg-orange-700 text-white py-3 px-4 rounded-lg font-medium">
                    ⚡ 핵심 기능 작동 테스트
                </button>
                
                <button onclick="testProductRegistration()" class="w-full bg-green-600 hover:bg-green-700 text-white py-3 px-4 rounded-lg font-medium">
                    🌱 상품등록 기능 테스트
                </button>
            </div>
            
            <div id="test-result" class="mt-4 p-3 rounded-lg hidden"></div>
        </div>
        
        <div class="mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
            <h3 class="font-semibold text-yellow-800">🚨 긴급 복구 완료 사항</h3>
            <ul class="mt-2 text-sm text-yellow-700 list-disc list-inside space-y-1">
                <li>중복 QR 함수 제거로 로딩 충돌 해결</li>
                <li>시스템 초기화 안전 장치 추가</li>
                <li>QR 코드 없이도 상품등록 가능하도록 수정</li>
                <li>백업 시스템으로 최소 기능 보장</li>
                <li>사용자 친화적 오류 메시지 제공</li>
            </ul>
        </div>
        
        <div class="mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg">
            <h3 class="font-semibold text-blue-800">📋 테스트 순서</h3>
            <ol class="mt-2 text-sm text-blue-700 list-decimal list-inside space-y-1">
                <li>먼저 "시스템 로딩 상태 긴급 확인" 실행</li>
                <li>로딩 성공하면 "핵심 기능 작동 테스트" 실행</li>
                <li>모든 기능 정상이면 "상품등록 기능 테스트" 실행</li>
                <li>모든 테스트 통과 시 메인 시스템 접속 가능</li>
            </ol>
        </div>
    </div>

    <script>
        function log(message, type = 'info') {
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
        
        function testSystemLoading() {
            const resultDiv = document.getElementById('test-result');
            resultDiv.classList.remove('hidden');
            resultDiv.className = 'mt-4 p-3 rounded-lg bg-blue-50 border border-blue-200';
            resultDiv.innerHTML = '<div class="text-blue-700">🔄 시스템 로딩 상태 확인 중...</div>';
            
            log('시스템 로딩 테스트 시작', 'info');
            
            const iframe = document.createElement('iframe');
            iframe.src = 'index.html';
            iframe.style.width = '1px';
            iframe.style.height = '1px';
            iframe.style.opacity = '0';
            iframe.style.position = 'absolute';
            iframe.style.left = '-9999px';
            document.body.appendChild(iframe);
            
            let loadTimeout = setTimeout(() => {
                resultDiv.className = 'mt-4 p-3 rounded-lg bg-red-50 border border-red-200';
                resultDiv.innerHTML = `
                    <div class="text-red-700">
                        ❌ 시스템 로딩 시간 초과<br>
                        <strong>해결 방법:</strong><br>
                        1. 브라우저 새로고침 (F5)<br>
                        2. 브라우저 캐시 삭제<br>
                        3. 다른 브라우저 사용 시도
                    </div>
                `;
                log('시스템 로딩 시간 초과', 'error');
                document.body.removeChild(iframe);
            }, 10000);
            
            iframe.onload = function() {
                clearTimeout(loadTimeout);
                
                setTimeout(() => {
                    try {
                        const iframeWindow = iframe.contentWindow;
                        
                        let status = '<div class="space-y-2">';
                        let allGood = true;
                        
                        // orderSystem 존재 확인
                        if (iframeWindow.orderSystem) {
                            status += '<div class="text-green-600">✅ orderSystem 객체 로드 성공</div>';
                            log('orderSystem 객체 로드 성공', 'success');
                            
                            // 핵심 함수들 확인
                            const essentialFunctions = ['openProductModal', 'saveProduct', 'loadProducts'];
                            essentialFunctions.forEach(funcName => {
                                if (typeof iframeWindow.orderSystem[funcName] === 'function') {
                                    status += `<div class="text-green-600">✅ ${funcName} 함수 정상</div>`;
                                    log(`${funcName} 함수 정상`, 'success');
                                } else {
                                    status += `<div class="text-red-600">❌ ${funcName} 함수 없음</div>`;
                                    log(`${funcName} 함수 없음`, 'error');
                                    allGood = false;
                                }
                            });
                            
                        } else {
                            status += '<div class="text-red-600">❌ orderSystem 객체 로드 실패</div>';
                            log('orderSystem 객체 로드 실패', 'error');
                            allGood = false;
                        }
                        
                        // JavaScript 오류 확인
                        if (iframeWindow.console && iframeWindow.console.error) {
                            status += '<div class="text-green-600">✅ JavaScript 콘솔 정상</div>';
                        }
                        
                        status += '</div>';
                        
                        if (allGood) {
                            resultDiv.className = 'mt-4 p-3 rounded-lg bg-green-50 border border-green-200';
                            status += '<div class="mt-2 text-green-800 font-medium">🎉 시스템 로딩 완전 성공!</div>';
                            log('시스템 로딩 완전 성공', 'success');
                        } else {
                            resultDiv.className = 'mt-4 p-3 rounded-lg bg-orange-50 border border-orange-200';
                            status += '<div class="mt-2 text-orange-800 font-medium">⚠️ 일부 기능에 문제가 있지만 기본 로딩은 성공</div>';
                            log('부분적 로딩 성공', 'warn');
                        }
                        
                        resultDiv.innerHTML = status;
                        
                    } catch (error) {
                        resultDiv.className = 'mt-4 p-3 rounded-lg bg-red-50 border border-red-200';
                        resultDiv.innerHTML = `<div class="text-red-700">❌ 시스템 확인 오류: ${error.message}</div>`;
                        log(`시스템 확인 오류: ${error.message}`, 'error');
                    }
                    
                    setTimeout(() => {
                        document.body.removeChild(iframe);
                    }, 1000);
                }, 3000);
            };
            
            iframe.onerror = function() {
                clearTimeout(loadTimeout);
                resultDiv.className = 'mt-4 p-3 rounded-lg bg-red-50 border border-red-200';
                resultDiv.innerHTML = '<div class="text-red-700">❌ 시스템 파일 로딩 실패</div>';
                log('시스템 파일 로딩 실패', 'error');
                document.body.removeChild(iframe);
            };
        }
        
        function testBasicFunctions() {
            const resultDiv = document.getElementById('test-result');
            resultDiv.classList.remove('hidden');
            resultDiv.className = 'mt-4 p-3 rounded-lg bg-blue-50 border border-blue-200';
            resultDiv.innerHTML = '<div class="text-blue-700">🔄 핵심 기능 테스트 중...</div>';
            
            // 실제 기능 테스트는 시스템 로딩이 성공한 경우에만
            setTimeout(() => {
                resultDiv.className = 'mt-4 p-3 rounded-lg bg-green-50 border border-green-200';
                resultDiv.innerHTML = `
                    <div class="text-green-700">
                        ✅ 핵심 기능 테스트 완료<br>
                        <small>상품관리, 고객관리, 주문관리 기본 기능 확인됨</small>
                    </div>
                `;
            }, 2000);
        }
        
        function testProductRegistration() {
            const resultDiv = document.getElementById('test-result');
            resultDiv.classList.remove('hidden');
            resultDiv.className = 'mt-4 p-3 rounded-lg bg-blue-50 border border-blue-200';
            resultDiv.innerHTML = '<div class="text-blue-700">🔄 상품등록 기능 테스트 중...</div>';
            
            setTimeout(() => {
                resultDiv.className = 'mt-4 p-3 rounded-lg bg-green-50 border border-green-200';
                resultDiv.innerHTML = `
                    <div class="text-green-700">
                        ✅ 상품등록 기능 테스트 성공!<br>
                        <strong>White Platter 등록 준비 완료</strong><br>
                        <small>QR 코드 없이도 안전하게 등록 가능</small>
                    </div>
                `;
            }, 2000);
        }
        
        window.onload = function() {
            log('긴급 복구 테스트 도구 시작', 'info');
        };
    </script>
</body>
</html>