const fs = require('fs');
const path = require('path');

// ê¹¨ì§„ í•œê¸€ íŒ¨í„´ê³¼ ì˜¬ë°”ë¥¸ í•œê¸€ ë§¤í•‘
const encodingFixes = {
    // ê²½ì‚°ë‹¤ìœ¡ì‹ë¬¼ë†ì¥ ê´€ë ¨
    'å¯ƒìŒê¶›?ã…¼ì‘?ì•¸Ğª?ë¿ì˜£': 'ê²½ì‚°ë‹¤ìœ¡ì‹ë¬¼ë†ì¥',
    'æ„¿ç”±ÑŠë–†?ã…½ë€¥': 'ê´€ë¦¬ì‹œìŠ¤í…œ',
    'æ„¿ç”±ÑŠë–†?ã…½ë€¥': 'ê´€ë¦¬ì‹œìŠ¤í…œ',
    
    // ê¸°íƒ€ ê¹¨ì§„ í•œê¸€ íŒ¨í„´ë“¤
    '?ã…¼ì‘': 'ë‹¤ìœ¡',
    '?ë¿ì˜£': 'ë†ì¥',
    'æ„¿': 'ê´€',
    'ç”±': 'ë¦¬',
    'ÑŠë–†': 'ì‹œìŠ¤',
    '?ã…½ë€¥': 'í…œ',
    
    // ì¶”ê°€ íŒ¨í„´ë“¤
    '?ê¾¨Ğ¦': 'ì „ë¬¸',
    '?ì’–ë’ª': 'ì‹œìŠ¤í…œ',
    '?ëª„ì“½': 'ê¸°ëŠ¥',
    '?ë“­ë––': 'ì—…ë°ì´íŠ¸',
    '?ì’•ëŠ¿': 'í™•ì¸',
    '?ëº¤ì”¤': 'í•˜ì„¸ìš”',
    '?ì„ê½­': 'í•©ë‹ˆë‹¤',
    '?â‘¸ë•²': 'ì…ë‹ˆë‹¤',
    '?ê¾¨ì¦º': 'ì™„ë£Œ',
    '?ã…¼íŠ‚': 'ì•±',
    '?ë¶¾ãˆƒ': 'í™ˆìŠ¤í¬ë¦°',
    '?ç•°ë¶½': 'ì¶”ê°€',
    '?ê¹†ì” ': 'ë†ì¥ì´',
    '?ê¹ƒë‚¬': 'ì„¤ì¹˜',
    '?ì„ë¿€': 'ë˜ì—ˆ',
    '?ë“¬ë•²': 'ìŠµë‹ˆë‹¤',
    '?ë®¶': 'ì´ì œ',
    '?ê¾¨ì¦º': 'ì™„ë£Œ',
    '?ëŒì £': 'ì´ì œ',
    '?ã…½ë´½': 'ì‚¬ìš©',
    '?ì‡±ì”¤': 'í•˜ì‹ ',
    '?ë¨¯ê½Œ': 'í†µí•´',
    '?ÑŠìŠœ': 'ì‚¬ìš©',
    '?ë‰ë’¿': 'í•˜ì‹¤',
    '?ëˆë–': 'ìˆ˜',
    '?ëº¢ë¦°': 'ë¸Œë¼ìš°ì €',
    '?ê³¸ì‘': 'ì—ì„œ',
    '?ê³—ì” ': 'ë°ì´í„°',
    '?è«›ê¹†ë¾½': 'ë³µêµ¬',
    '?ëŒï¼œ': 'í•´ì£¼',
    '?ëª„ìŠ‚': 'ì„¸ìš”',
    '?ë®•': 'ë˜í•œ',
    '?ë‰ìŸ¾': 'ì´ì „',
    '?æ€¨ë…¹': 'ë°±ì—…',
    '?è¹‚ë‹¿': 'ë³´ê´€',
    '?ì„ê½­': 'í•˜ì„¸ìš”',
    '?ë™®': 'ì´ì œ',
    '?ê¹†ì” ': 'ë†ì¥ì´',
    '?ë¶¾ãˆƒ': 'í™ˆìŠ¤í¬ë¦°',
    '?ç•°ë¶½': 'ì¶”ê°€',
    '?â‘¸ë•²': 'ë˜ì—ˆìŠµë‹ˆë‹¤',
    '?ë®¶': 'ì´ì œ',
    '?ê¾¨ì¦º': 'ì™„ë£Œ',
    '?ëŒì £': 'ì´ì œ',
    '?ã…½ë´½': 'ì‚¬ìš©',
    '?ì‡±ì”¤': 'í•˜ì‹ ',
    '?ë¨¯ê½Œ': 'í†µí•´',
    '?ÑŠìŠœ': 'ì‚¬ìš©',
    '?ë‰ë’¿': 'í•˜ì‹¤',
    '?ëˆë–': 'ìˆ˜',
    '?ëº¢ë¦°': 'ë¸Œë¼ìš°ì €',
    '?ê³¸ì‘': 'ì—ì„œ',
    '?ê³—ì” ': 'ë°ì´í„°',
    '?è«›ê¹†ë¾½': 'ë³µêµ¬',
    '?ëŒï¼œ': 'í•´ì£¼',
    '?ëª„ìŠ‚': 'ì„¸ìš”',
    '?ë®•': 'ë˜í•œ',
    '?ë‰ìŸ¾': 'ì´ì „',
    '?æ€¨ë…¹': 'ë°±ì—…',
    '?è¹‚ë‹¿': 'ë³´ê´€',
    '?ì„ê½­': 'í•˜ì„¸ìš”'
};

// íŒŒì¼ì„ ì¬ê·€ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ëŠ” í•¨ìˆ˜
function processDirectory(dirPath) {
    const items = fs.readdirSync(dirPath);
    
    items.forEach(item => {
        const fullPath = path.join(dirPath, item);
        const stat = fs.statSync(fullPath);
        
        if (stat.isDirectory()) {
            // node_modules, .git ë“±ì€ ì œì™¸
            if (!item.startsWith('.') && item !== 'node_modules' && item !== 'dist-web') {
                processDirectory(fullPath);
            }
        } else if (stat.isFile()) {
            // í…ìŠ¤íŠ¸ íŒŒì¼ë§Œ ì²˜ë¦¬
            const ext = path.extname(item).toLowerCase();
            if (['.html', '.js', '.md', '.json', '.sql', '.txt', '.bat', '.sh'].includes(ext)) {
                processFile(fullPath);
            }
        }
    });
}

// ê°œë³„ íŒŒì¼ ì²˜ë¦¬ í•¨ìˆ˜
function processFile(filePath) {
    try {
        let content = fs.readFileSync(filePath, 'utf8');
        let modified = false;
        
        // ê° ê¹¨ì§„ íŒ¨í„´ì„ ì˜¬ë°”ë¥¸ í•œê¸€ë¡œ êµì²´
        Object.keys(encodingFixes).forEach(broken => {
            const fixed = encodingFixes[broken];
            if (content.includes(broken)) {
                content = content.replace(new RegExp(broken, 'g'), fixed);
                modified = true;
            }
        });
        
        // ìˆ˜ì •ëœ ë‚´ìš©ì´ ìˆìœ¼ë©´ íŒŒì¼ ì €ì¥
        if (modified) {
            fs.writeFileSync(filePath, content, 'utf8');
            console.log(`âœ… ìˆ˜ì •ë¨: ${filePath}`);
        }
        
    } catch (error) {
        console.log(`âŒ ì˜¤ë¥˜: ${filePath} - ${error.message}`);
    }
}

// ë©”ì¸ ì‹¤í–‰
console.log('ğŸ”§ í•œê¸€ ì¸ì½”ë”© ìˆ˜ì • ì‹œì‘...');
processDirectory('.');
console.log('ğŸ‰ í•œê¸€ ì¸ì½”ë”© ìˆ˜ì • ì™„ë£Œ!');
