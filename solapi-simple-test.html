<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>솔라피 SMS 간단 테스트</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
</head>
<body>
    <h1>솔라피 SMS 간단 테스트</h1>
    <button onclick="sendSMS()">SMS 발송</button>
    <div id="result"></div>

    <script>
        async function sendSMS() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '발송 중...';
            
            try {
                // API 설정
                const apiKey = "NCS4ZXQ1JWMUPQ3W";
                const apiSecret = "MLER1HFO30FJGXMZLEN9P82TZL6ZWEM2";
                const fromNumber = "01097456245";
                const toNumber = "01085582436";
                
                // 시간과 솔트 생성
                const date = new Date().toISOString();
                const salt = CryptoJS.lib.WordArray.random(16).toString(CryptoJS.enc.Hex);
                
                // 서명 생성 (솔라피는 Hex 형식 필요)
                const messageToSign = date + salt;
                const signature = CryptoJS.HmacSHA256(messageToSign, apiSecret).toString(CryptoJS.enc.Hex);
                
                console.log('=== 솔라피 SMS 발송 정보 ===');
                console.log('API Key:', apiKey);
                console.log('API Secret:', apiSecret.substring(0, 8) + '...');
                console.log('Date:', date);
                console.log('Salt:', salt);
                console.log('Message to Sign:', messageToSign);
                console.log('Signature:', signature);
                
                // API 요청
                const response = await fetch('https://api.solapi.com/messages/v4/send', {
                    method: 'POST',
                    headers: {
                        'Authorization': `HMAC-SHA256 apiKey=${apiKey}, date=${date}, salt=${salt}, signature=${signature}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: {
                            to: toNumber,
                            from: fromNumber,
                            text: "[테스트] 솔라피 SMS 발송 테스트입니다."
                        }
                    })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    resultDiv.innerHTML = `✅ 성공! ${JSON.stringify(result)}`;
                    console.log('✅ SMS 발송 성공:', result);
                } else {
                    resultDiv.innerHTML = `❌ 실패: ${JSON.stringify(result)}`;
                    console.error('❌ SMS 발송 실패:', result);
                    console.error('❌ 응답 상태:', response.status);
                    console.error('❌ 응답 헤더:', response.headers);
                }
                
            } catch (error) {
                resultDiv.innerHTML = `❌ 오류: ${error.message}`;
                console.error('❌ 오류:', error);
            }
        }
    </script>
</body>
</html>
